"use strict";const U=require("@codemirror/state"),t=require("@lezer/highlight"),m=require("markedit-api"),P=require("@codemirror/view"),p=require("@codemirror/language"),v=(n,a={})=>n??a,K=v(m.MarkEdit.userSettings),T=v(K["extension.markeditTheming"]),J=T.enabledMode??"both",q=v(T.lightTheme),_=v(T.darkTheme),O=n=>["both",n?"dark":"light"].includes(J),Q=H(q),W=H(_,{dark:!0});function X(n,a){if(!O(n))return a;const e=n?W:Q;return e===void 0?a:[e,a].filter(r=>r!==void 0)}function Y(n,a){if(!O(n))return a;const e=n?_.custom:q.custom;return e===void 0?a:{...a,...e}}function H(n,a){const e={},r=[],c=n.editor,o=n.highlight;return c?.textColor&&(e["&"]??={},e["&"].color=c?.textColor,e[".cm-activeLineGutter"]={backgroundColor:c?.textColor}),c?.backgroundColor&&(e["&"]??={},e["&"].backgroundColor=c?.backgroundColor),c?.activeLineBackground&&(e[".cm-activeLine"]={backgroundColor:c?.activeLineBackground}),c?.caretColor&&(e[".cm-content"]={caretColor:c?.caretColor},e[".cm-cursor, .cm-dropCursor"]={borderLeftColor:c?.caretColor}),c?.selectionBackground&&(e["&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection"]={backgroundColor:c?.selectionBackground}),c?.matchingBracketBackground&&(e["&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket"]={backgroundColor:c?.matchingBracketBackground}),c?.gutterText&&(e[".cm-gutters"]??={},e[".cm-gutters"].color=c?.gutterText),c?.gutterBackground&&(e[".cm-gutters"]??={},e[".cm-gutters"].backgroundColor=c?.gutterBackground,e[".cm-gutters"].border="none"),c?.foldPlaceholderText&&(e[".cm-foldPlaceholder"]??={},e[".cm-foldPlaceholder"].color=c?.foldPlaceholderText),c?.foldPlaceholderBackground&&(e[".cm-foldPlaceholder"]??={},e[".cm-foldPlaceholder"].backgroundColor=c?.foldPlaceholderBackground,e[".cm-foldPlaceholder"].border="none"),c?.searchMatchBackground&&(e[".cm-searchMatch"]={backgroundColor:c?.searchMatchBackground}),c?.selectionMatchBackground&&(e[".cm-selectionMatch"]={backgroundColor:c?.selectionMatchBackground}),o?.heading&&r.push({tag:t.tags.heading,color:o?.heading}),o?.bold&&r.push({tag:t.tags.strong,color:o?.bold}),o?.italic&&r.push({tag:t.tags.emphasis,color:o?.italic}),o?.strikethrough&&r.push({tag:t.tags.strikethrough,color:o?.strikethrough}),o?.quote&&r.push({tag:t.tags.quote,color:o?.quote}),o?.link&&r.push({tag:t.tags.link,color:o?.link}),o?.separator&&r.push({tag:[t.tags.definition(t.tags.name),t.tags.separator,t.tags.contentSeparator],color:o?.separator}),o?.comment&&r.push({tag:[t.tags.meta,t.tags.comment],color:o?.comment}),o?.meta&&r.push({tag:t.tags.meta,color:o?.meta}),o?.keyword&&r.push({tag:t.tags.keyword,color:o?.keyword}),o?.atom&&r.push({tag:[t.tags.atom,t.tags.bool,t.tags.url,t.tags.contentSeparator,t.tags.labelName],color:o?.atom}),o?.literal&&r.push({tag:[t.tags.literal,t.tags.inserted],color:o?.literal}),o?.string&&r.push({tag:[t.tags.string,t.tags.deleted],color:o?.string}),o?.special&&r.push({tag:[t.tags.regexp,t.tags.escape,t.tags.special(t.tags.string)],color:o?.special}),o?.variable&&r.push({tag:t.tags.definition(t.tags.variableName),color:o?.variable}),o?.local&&r.push({tag:t.tags.local(t.tags.variableName),color:o?.local}),o?.type&&r.push({tag:[t.tags.typeName,t.tags.namespace],color:o?.type}),o?.class&&r.push({tag:t.tags.className,color:o?.class}),o?.macro&&r.push({tag:[t.tags.special(t.tags.variableName),t.tags.macroName],color:o?.macro}),o?.property&&r.push({tag:t.tags.definition(t.tags.propertyName),color:o?.property}),o?.label&&r.push({tag:t.tags.labelName,color:o?.label}),o?.operator&&r.push({tag:[t.tags.operator,t.tags.operatorKeyword],color:o?.operator}),o?.constant&&r.push({tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:o?.constant}),o?.instruction&&r.push({tag:t.tags.processingInstruction,color:o?.instruction}),o?.invalid&&r.push({tag:t.tags.invalid,color:o?.invalid}),[P.EditorView.theme(e,a),p.syntaxHighlighting(p.HighlightStyle.define(r))]}const s={selectionBackground:".cm-selectionBackground",lineGutter:".cm-lineNumbers > .cm-activeLineGutter",foldGutter:".cm-foldGutter, .cm-foldPlaceholder",visibleSpace:".cm-visibleSpace, .cm-visibleSpace::before, .cm-visibleLineBreak, .cm-visibleLineBreak::before",matchingBracket:".cm-matchingBracket",activeIndicator:".cm-md-activeIndicator",emphasisElement:".cm-md-bold:not(.tok-meta), .cm-md-italic:not(.tok-meta), .cm-md-quote:not(.cm-md-quoteMark)",accentColor:".cm-md-header:not(.tok-meta):not(.cm-md-quote), .cm-md-codeInfo",syntaxMarker:".cm-md-header.tok-meta:not(.cm-md-quote), .cm-md-codeMark, .cm-md-linkMark, .cm-md-listMark, .cm-md-quoteMark"},Z=`
.cm-activeLineGutter { background: inherit !important }
.cm-searchMatch.cm-searchMatch-selected { outline: inherit !important }
${s.lineGutter} {}
${s.foldGutter} {}
${s.visibleSpace} {}
${s.matchingBracket} {}
${s.activeIndicator} {}
${s.emphasisElement} {}
${s.accentColor} {}
${s.syntaxMarker} {}
`,G=window,tt=G.__extractStyleRules__??(n=>n.value?.rules),et=G.__extractHighlightSpecs__??(n=>n.value?.specs);function ot(n){const a=document.createElement("style");return a.textContent=n,document.head.appendChild(a),a}function rt(n){if(n===void 0)return[{},[]];const a=ct(n);return[Object.fromEntries(a.flatMap(r=>{const c=tt(r)?.join(`
`)??"";return Object.entries(nt(c))})),a.flatMap(r=>et(r)??[])]}function L(n,a){return n.find(e=>!!(e.tag.toString().includes(a.toString())&&e.color!==void 0))?.color}function x(n,a,e){for(const[r,c]of Object.entries(n))if(r.includes(a)&&(e===void 0||!r.includes(e))){const o=c.background??c.backgroundColor;if(o!==void 0)return o}}function at(n){const a=n.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(a===null)return;const[e,r,c]=a.slice(1,4).map(Number);return`rgba(${e}, ${r}, ${c}, 0.6)`}function ct(n){const a=[],e=[n];for(;e.length>0;){const r=e.pop();Array.isArray(r)?r.forEach(c=>e.push(c)):"extension"in r?e.push(r.extension):a.push(r)}return a}function nt(n){const a={},e=new CSSStyleSheet;e.replaceSync(n);for(const r of e.cssRules){const{style:c,selectorText:o}=r,{background:g,backgroundColor:u}=c;a[o]={},g.length>0&&(a[o].background=g),u.length>0&&(a[o].backgroundColor=u)}return a}function st(n){n.light!==void 0&&(i().customThemes.light=n.light),n.dark!==void 0&&(i().customThemes.dark=n.dark),typeof m.MarkEdit.editorView=="object"&&S(m.MarkEdit.editorView)}const k=window,i=()=>k.__markeditTheming__,I=matchMedia("(prefers-color-scheme: dark)");typeof i()!="object"&&it();function it(){k.__markeditTheming__={styleSheet:ot(Z),configurator:new U.Compartment,customThemes:{},lightOriginalRules:{},darkOriginalRules:{}},m.MarkEdit.addExtension(i().configurator.of([])),m.MarkEdit.onEditorReady(a=>S(a));const n=()=>setTimeout(()=>S(m.MarkEdit.editorView),15);I.addEventListener("change",n),i().mainThemeName=k.config.theme,Object.defineProperty(k.config,"theme",{get(){return i().mainThemeName},set(a){i().mainThemeName=a,n()}})}function S(n){const a=I.matches,e=a?i().customThemes.dark:i().customThemes.light,r=X(a,e?.extension),c=Y(a,e?.colors);n.dispatch({effects:i().configurator.reconfigure(r??[])});const[o,g]=rt(r),u=r===void 0;i().styleSheet.disabled=u,lt(n,a,u,o,g,c)}function lt(n,a,e,r,c,o){const g=x(r,".cm-activeLine",".cm-activeLineGutter"),u=x(r,s.selectionBackground),y=x(r,s.matchingBracket),h=getComputedStyle(n.contentDOM).color,M=o?.visibleSpace??at(h),R=L(c,t.tags.heading)!==void 0,F=L(c,t.tags.processingInstruction),A=[[s.activeIndicator,g,"background"],[s.matchingBracket,y,"background"],[s.lineGutter,h,"color"],[s.foldGutter,M,"color"],[s.visibleSpace,M,"color"],[s.accentColor,o?.accentColor,"color"],[s.syntaxMarker,F??o?.syntaxMarker,"color"]],D=Array.from(document.querySelectorAll("style")),f=a?i().darkOriginalRules:i().lightOriginalRules;for(const V of D){const C=V.sheet?.cssRules;if(C!==void 0)for(let B=0;B<C.length;++B){const l=C[B],d=l.selectorText??"";d.includes(".cm-focused")&&d.includes(s.selectionBackground)&&(f.selectionBackground??=l.cssText,e?l.cssText=f.selectionBackground:u!==void 0&&l.style.setProperty("background",u,"important")),R&&(d===".cm-md-header"||d===".cm-md-header:not(.cm-md-quote)")&&(f.markdownHeader??=l.cssText,e?l.cssText=f.markdownHeader:l.style.removeProperty("color"));for(const[z,N,w]of A)d===z&&(N===void 0?l.style.removeProperty(w):(l.style.setProperty(w,N,"important"),(d===s.matchingBracket||d===s.activeIndicator)&&l.style.setProperty("box-shadow","unset","important")));d===s.emphasisElement&&(o?.subtleEmphasis??!0?l.style.setProperty("color","inherit","important"):l.style.removeProperty("color"))}}}function b(){return b=Object.assign?Object.assign.bind():function(n){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var r in e)({}).hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},b.apply(null,arguments)}var j=n=>{var{theme:a,settings:e={},styles:r=[]}=n,c={".cm-gutters":{}},o={};e.background&&(o.backgroundColor=e.background),e.backgroundImage&&(o.backgroundImage=e.backgroundImage),e.foreground&&(o.color=e.foreground),e.fontSize&&(o.fontSize=e.fontSize),(e.background||e.foreground)&&(c["&"]=o),e.fontFamily&&(c["&.cm-editor .cm-scroller"]={fontFamily:e.fontFamily}),e.gutterBackground&&(c[".cm-gutters"].backgroundColor=e.gutterBackground),e.gutterForeground&&(c[".cm-gutters"].color=e.gutterForeground),e.gutterBorder&&(c[".cm-gutters"].borderRightColor=e.gutterBorder),e.caret&&(c[".cm-content"]={caretColor:e.caret},c[".cm-cursor, .cm-dropCursor"]={borderLeftColor:e.caret});var g={};e.gutterActiveForeground&&(g.color=e.gutterActiveForeground),e.lineHighlight&&(c[".cm-activeLine"]={backgroundColor:e.lineHighlight},g.backgroundColor=e.lineHighlight),c[".cm-activeLineGutter"]=g,e.selection&&(c["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:e.selection+" !important"}),e.selectionMatch&&(c["& .cm-selectionMatch"]={backgroundColor:e.selectionMatch});var u=P.EditorView.theme(c,{dark:a==="dark"}),y=p.HighlightStyle.define(r),h=[u,p.syntaxHighlighting(y)];return h},gt={background:"#faf8f5",foreground:"#b29762",caret:"#93abdc",selection:"#e3dcce",selectionMatch:"#e3dcce",gutterBackground:"#faf8f5",gutterForeground:"#cdc4b1",gutterBorder:"transparent",lineHighlight:"#ddceb154"},ut=[{tag:[t.tags.comment,t.tags.bracket],color:"#b6ad9a"},{tag:[t.tags.atom,t.tags.number,t.tags.keyword,t.tags.link,t.tags.attributeName,t.tags.quote],color:"#063289"},{tag:[t.tags.emphasis,t.tags.heading,t.tags.tagName,t.tags.propertyName,t.tags.variableName],color:"#2d2006"},{tag:[t.tags.typeName,t.tags.url,t.tags.string],color:"#896724"},{tag:[t.tags.operator,t.tags.string],color:"#1659df"},{tag:[t.tags.propertyName],color:"#b29762"},{tag:[t.tags.unit,t.tags.punctuation],color:"#063289"}],dt=n=>{var{theme:a="light",settings:e={},styles:r=[]}={};return j({theme:a,settings:b({},gt,e),styles:[...ut,...r]})},mt=dt(),ht={background:"#2a2734",foreground:"#6c6783",caret:"#ffad5c",selection:"#91ff6c26",selectionMatch:"#91ff6c26",gutterBackground:"#2a2734",gutterForeground:"#545167",lineHighlight:"#36334280"},ft=[{tag:[t.tags.comment,t.tags.bracket],color:"#6c6783"},{tag:[t.tags.atom,t.tags.number,t.tags.keyword,t.tags.link,t.tags.attributeName,t.tags.quote],color:"#ffcc99"},{tag:[t.tags.emphasis,t.tags.heading,t.tags.tagName,t.tags.propertyName,t.tags.className,t.tags.variableName],color:"#eeebff"},{tag:[t.tags.typeName,t.tags.url],color:"#7a63ee"},{tag:t.tags.operator,color:"#ffad5c"},{tag:t.tags.string,color:"#ffb870"},{tag:[t.tags.propertyName],color:"#9a86fd"},{tag:[t.tags.unit,t.tags.punctuation],color:"#e09142"}],kt=n=>{var{theme:a="dark",settings:e={},styles:r=[]}={};return j({theme:a,settings:b({},ht,e),styles:[...ft,...r]})},pt=kt();const $=(n,a={})=>n??a,bt=$($(m.MarkEdit.userSettings)["extension.markeditThemeDuoTone"]),E=bt.enabledMode??"both",vt={extension:mt},yt={extension:pt};st({light:["both","light"].includes(E)?vt:void 0,dark:["both","dark"].includes(E)?yt:void 0});
