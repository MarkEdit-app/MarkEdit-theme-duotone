"use strict";const tt=require("@codemirror/state"),t=require("@lezer/highlight"),k=require("markedit-api"),H=require("@codemirror/view"),C=require("@codemirror/language"),F=window,et=F.__extractStyleRules__??(a=>a.value?.rules),ot=F.__extractHighlightSpecs__??(a=>a.value?.specs);function rt(a){const n=document.createElement("style");return n.textContent=a,document.head.appendChild(n),n}function at(a){if(a.length===0)return[{},[]];const n=x(a);return[Object.fromEntries(n.flatMap(c=>{const r=et(c)?.join(`
`)??"";return Object.entries(ct(r))})),n.flatMap(c=>ot(c)??[])]}function f(a,n,e){return a.find(c=>!!(c.tag.toString().includes(n.toString())&&c.color!==void 0))?.color??e}function $(a,n,e){for(const[c,r]of Object.entries(a))if(c.includes(n)&&(e===void 0||!c.includes(e))){const o=r.background??r.backgroundColor;if(o!==void 0)return o}}function y(a,n=.6){const e=a.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(e===null)return;const[c,r,o]=e.slice(1,4).map(Number);return`rgba(${c}, ${r}, ${o}, ${n})`}function j(a){const n=r=>r!==null&&typeof r=="object";if(!n(a))return!0;const e=Object.entries(a),c=r=>r!=null;for(const[,r]of e)if(n(r)){if(!j(r))return!1}else if(c(r))return!1;return!0}function x(a){return Array.isArray(a)?a.flatMap(x):"extension"in a?x(a.extension):[a]}function ct(a){const n={},e=new CSSStyleSheet;e.replaceSync(a);for(const c of e.cssRules){const{style:r,selectorText:o}=c,{background:s,backgroundColor:g}=r;n[o]={},s.length>0&&(n[o].background=s),g.length>0&&(n[o].backgroundColor=g)}return n}const M=(a,n={})=>a??n,nt=M(k.MarkEdit.userSettings),q=I("extension.markeditTheming"),it=T(!1)?M(q.lightTheme):void 0,st=T(!0)?M(q.darkTheme):void 0;function I(a){return a===void 0?{}:M(nt[a])}function R(a){return a.enabledMode??"both"}function T(a,n=R(q)){return["both",a?"dark":"light"].includes(n)}function lt(a,n,e){const c=gt({lhs:e,rhs:a?st:it});return x(n??[]).forEach(o=>{const s=o;s.value&&Array.isArray(s.value?.rules)&&(s.value.rules=s.value?.rules.filter(g=>!`${g}`.includes(".cm-tooltip")))}),{extensions:[...a?_(c,{dark:!0}):_(c),n].filter(o=>o!==void 0),colors:c}}function _(a,n){const e={},c=[],r=a.editor,o=a.highlight;r?.textColor&&(e["&"]??={},e["&"].color=r?.textColor,e[".cm-activeLineGutter"]={backgroundColor:r?.textColor}),r?.backgroundColor&&(e["&"]??={},e["&"].backgroundColor=r?.backgroundColor),r?.activeLineBackground&&(e[".cm-activeLine"]={backgroundColor:r?.activeLineBackground}),r?.caretColor&&(e[".cm-content"]={caretColor:r?.caretColor},e[".cm-cursor, .cm-dropCursor"]={borderLeftColor:r?.caretColor}),r?.selectionBackground&&(e["&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection"]={backgroundColor:r?.selectionBackground}),r?.matchingBracketBackground&&(e["&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket"]={backgroundColor:r?.matchingBracketBackground}),r?.gutterText&&(e[".cm-gutters"]??={},e[".cm-gutters"].color=r?.gutterText),r?.gutterBackground&&(e[".cm-gutters"]??={},e[".cm-gutters"].backgroundColor=r?.gutterBackground,e[".cm-gutters"].border="none"),r?.foldPlaceholderText&&(e[".cm-foldPlaceholder"]??={},e[".cm-foldPlaceholder"].color=r?.foldPlaceholderText),r?.foldPlaceholderBackground&&(e[".cm-foldPlaceholder"]??={},e[".cm-foldPlaceholder"].backgroundColor=r?.foldPlaceholderBackground,e[".cm-foldPlaceholder"].border="none"),r?.searchMatchBackground&&(e[".cm-searchMatch"]={backgroundColor:r?.searchMatchBackground}),r?.selectionMatchBackground&&(e[".cm-selectionMatch"]={backgroundColor:r?.selectionMatchBackground}),o?.heading&&c.push({tag:t.tags.heading,color:o?.heading}),o?.bold&&c.push({tag:t.tags.strong,color:o?.bold}),o?.italic&&c.push({tag:t.tags.emphasis,color:o?.italic}),o?.strikethrough&&c.push({tag:t.tags.strikethrough,color:o?.strikethrough}),o?.quote&&c.push({tag:t.tags.quote,color:o?.quote}),o?.link&&c.push({tag:[t.tags.url,t.tags.link],color:o?.link}),o?.divider&&c.push({tag:t.tags.contentSeparator,color:o?.divider}),o?.comment&&c.push({tag:t.tags.comment,color:o?.comment}),o?.meta&&c.push({tag:t.tags.meta,color:o?.meta}),o?.keyword&&c.push({tag:t.tags.keyword,color:o?.keyword}),o?.atom&&c.push({tag:[t.tags.atom,t.tags.bool],color:o?.atom}),o?.literal&&c.push({tag:[t.tags.literal,t.tags.inserted],color:o?.literal}),o?.string&&c.push({tag:[t.tags.string,t.tags.deleted],color:o?.string}),o?.special&&c.push({tag:[t.tags.regexp,t.tags.escape,t.tags.special(t.tags.string)],color:o?.special}),o?.variable&&c.push({tag:t.tags.definition(t.tags.variableName),color:o?.variable}),o?.local&&c.push({tag:t.tags.local(t.tags.variableName),color:o?.local}),o?.type&&c.push({tag:[t.tags.typeName,t.tags.namespace],color:o?.type}),o?.class&&c.push({tag:t.tags.className,color:o?.class}),o?.macro&&c.push({tag:[t.tags.special(t.tags.variableName),t.tags.macroName],color:o?.macro}),o?.property&&c.push({tag:t.tags.definition(t.tags.propertyName),color:o?.property}),o?.label&&c.push({tag:t.tags.labelName,color:o?.label}),o?.operator&&c.push({tag:[t.tags.operator,t.tags.operatorKeyword],color:o?.operator}),o?.constant&&c.push({tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:o?.constant}),o?.instruction&&c.push({tag:[t.tags.separator,t.tags.processingInstruction,t.tags.definition(t.tags.name)],color:o?.instruction}),o?.invalid&&c.push({tag:t.tags.invalid,color:o?.invalid});const s=[];return Object.keys(e).length>0&&s.push(H.EditorView.theme(e,n)),c.length>0&&s.push(C.syntaxHighlighting(C.HighlightStyle.define(c))),s}function gt(a){return{editor:{...a.lhs?.editor,...a.rhs?.editor},highlight:{...a.lhs?.highlight,...a.rhs?.highlight},allowsFallback:a.rhs?.allowsFallback??a.lhs?.allowsFallback}}const i={selectionBackground:".cm-selectionBackground",primaryText:".cm-lineNumbers > .cm-activeLineGutter, .cm-tooltip-autocomplete ul li, .cm-tooltip-autocomplete ul li[aria-selected]",secondaryText:".cm-foldGutter, .cm-foldPlaceholder, .cm-visibleSpace, .cm-visibleSpace::before, .cm-visibleLineBreak, .cm-visibleLineBreak::before",matchingBracket:".cm-matchingBracket",activeIndicator:".cm-md-activeIndicator",accentColor:".cm-md-header:not(.tok-meta):not(.cm-md-quote), .cm-md-codeInfo, .cm-completionMatchedText",syntaxMarker:".cm-md-header.tok-meta:not(.cm-md-quote), .cm-md-codeMark, .cm-md-linkMark, .cm-md-listMark, .cm-md-quoteMark, .cm-md-bold.tok-meta, .cm-md-italic.tok-meta, .cm-md-strikethrough.tok-meta",boldText:".cm-md-bold:not(.tok-meta)",italicText:".cm-md-italic:not(.tok-meta)",quoteText:".cm-md-quote:not(.cm-md-quoteMark)",dividerColor:".cm-md-horizontalRule",autocomplete:".cm-tooltip-autocomplete",autocompleteHighlight:".cm-tooltip-autocomplete ul li[aria-selected]"},ut=`
.cm-activeLineGutter { background: inherit !important }
.cm-searchMatch.cm-searchMatch-selected { outline: inherit !important }
${i.primaryText} {}
${i.secondaryText} {}
${i.matchingBracket} {}
${i.activeIndicator} {}
${i.accentColor} {}
${i.syntaxMarker} {}
${i.boldText} {}
${i.italicText} {}
${i.quoteText} {}
${i.dividerColor} {}
${i.autocomplete} {}
${i.autocompleteHighlight} {}
`;function dt(a){const n=a.options?.settingsKey,e=R(I(n));a.light!==void 0&&T(!1,e)&&(l().customThemes.light=a.light),a.dark!==void 0&&T(!0,e)&&(l().customThemes.dark=a.dark),typeof k.MarkEdit.editorView=="object"&&L(k.MarkEdit.editorView)}const v=window,l=()=>v.__markeditTheming__,A=matchMedia("(prefers-color-scheme: dark)");typeof l()!="object"&&mt();function mt(){v.__markeditTheming__={styleSheet:rt(ut),configurator:new tt.Compartment,customThemes:{},lightOriginalRules:{},darkOriginalRules:{}},k.MarkEdit.addExtension(l().configurator.of([])),k.MarkEdit.onEditorReady(n=>L(n));const a=()=>setTimeout(()=>L(k.MarkEdit.editorView),200);A.addEventListener("change",a),l().mainThemeName=v.config.theme,Object.defineProperty(v.config,"theme",{get(){return l().mainThemeName},set(n){l().mainThemeName=n,a()}})}function L(a){const n=A.matches,e=n?l().customThemes.dark:l().customThemes.light,{extensions:c,colors:r}=lt(n,e?.extension,e?.colors);a.dispatch({effects:l().configurator.reconfigure(c)});const[o,s]=at(c),g=c.length===0&&j(r),m=r.allowsFallback??e?.extension!==void 0;l().styleSheet.disabled=g,ht(a,n,g,o,s,r,m)}function ht(a,n,e,c,r,o,s){const g=$(c,".cm-activeLine",".cm-activeLineGutter"),m=$(c,i.selectionBackground),S=$(c,i.matchingBracket),V=getComputedStyle(a.dom).backgroundColor,p=getComputedStyle(a.contentDOM).color,G=o.editor?.visibleSpaceColor??y(p),h=s?p:void 0,E=f(r,t.tags.heading,h),z=f(r,t.tags.processingInstruction,h),K=f(r,t.tags.strong,h),U=f(r,t.tags.emphasis,h),J=f(r,t.tags.quote,h),Q=f(r,t.tags.contentSeparator,h),W=[[i.activeIndicator,g,"background"],[i.matchingBracket,S,"background"],[i.primaryText,p,"color"],[i.secondaryText,G,"color"],[i.accentColor,E,"color"],[i.syntaxMarker,z,"color"],[i.boldText,K,"color"],[i.italicText,U,"color"],[i.quoteText,J,"color"],[i.dividerColor,Q,"color"],[i.autocomplete,y(V),"background"],[i.autocomplete,`1px solid ${y(p,.3)}`,"border"],[i.autocompleteHighlight,y(p,.1),"background"]],X=Array.from(document.querySelectorAll("style")),b=n?l().darkOriginalRules:l().lightOriginalRules;for(const Y of X){const w=Y.sheet?.cssRules;if(w!==void 0)for(let N=0;N<w.length;++N){const u=w[N],d=u.selectorText??"";d.includes(".cm-focused")&&d.includes(i.selectionBackground)&&(b.selectionBackground??=u.cssText,e?u.cssText=b.selectionBackground:m!==void 0&&u.style.setProperty("background",m,"important")),E!==void 0&&(d===".cm-md-header"||d===".cm-md-header:not(.cm-md-quote)")&&(b.markdownHeader??=u.cssText,e?u.cssText=b.markdownHeader:u.style.removeProperty("color"));for(const[Z,O,P]of W)d===Z&&(O===void 0?u.style.removeProperty(P):(u.style.setProperty(P,O,"important"),(d===i.matchingBracket||d===i.activeIndicator)&&u.style.setProperty("box-shadow","unset","important")))}}}function B(){return B=Object.assign?Object.assign.bind():function(a){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var c in e)({}).hasOwnProperty.call(e,c)&&(a[c]=e[c])}return a},B.apply(null,arguments)}var D=a=>{var{theme:n,settings:e={},styles:c=[]}=a,r={".cm-gutters":{}},o={};e.background&&(o.backgroundColor=e.background),e.backgroundImage&&(o.backgroundImage=e.backgroundImage),e.foreground&&(o.color=e.foreground),e.fontSize&&(o.fontSize=e.fontSize),(e.background||e.foreground)&&(r["&"]=o),e.fontFamily&&(r["&.cm-editor .cm-scroller"]={fontFamily:e.fontFamily}),e.gutterBackground&&(r[".cm-gutters"].backgroundColor=e.gutterBackground),e.gutterForeground&&(r[".cm-gutters"].color=e.gutterForeground),e.gutterBorder&&(r[".cm-gutters"].borderRightColor=e.gutterBorder),e.caret&&(r[".cm-content"]={caretColor:e.caret},r[".cm-cursor, .cm-dropCursor"]={borderLeftColor:e.caret});var s={};e.gutterActiveForeground&&(s.color=e.gutterActiveForeground),e.lineHighlight&&(r[".cm-activeLine"]={backgroundColor:e.lineHighlight},s.backgroundColor=e.lineHighlight),r[".cm-activeLineGutter"]=s,e.selection&&(r["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:e.selection+" !important"}),e.selectionMatch&&(r["& .cm-selectionMatch"]={backgroundColor:e.selectionMatch});var g=H.EditorView.theme(r,{dark:n==="dark"}),m=C.HighlightStyle.define(c),S=[g,C.syntaxHighlighting(m)];return S},ft={background:"#faf8f5",foreground:"#b29762",caret:"#93abdc",selection:"#e3dcce",selectionMatch:"#e3dcce",gutterBackground:"#faf8f5",gutterForeground:"#cdc4b1",gutterBorder:"transparent",lineHighlight:"#ddceb154"},kt=[{tag:[t.tags.comment,t.tags.bracket],color:"#b6ad9a"},{tag:[t.tags.atom,t.tags.number,t.tags.keyword,t.tags.link,t.tags.attributeName,t.tags.quote],color:"#063289"},{tag:[t.tags.emphasis,t.tags.heading,t.tags.tagName,t.tags.propertyName,t.tags.variableName],color:"#2d2006"},{tag:[t.tags.typeName,t.tags.url,t.tags.string],color:"#896724"},{tag:[t.tags.operator,t.tags.string],color:"#1659df"},{tag:[t.tags.propertyName],color:"#b29762"},{tag:[t.tags.unit,t.tags.punctuation],color:"#063289"}],pt=a=>{var{theme:n="light",settings:e={},styles:c=[]}={};return D({theme:n,settings:B({},ft,e),styles:[...kt,...c]})},bt=pt(),yt={background:"#2a2734",foreground:"#6c6783",caret:"#ffad5c",selection:"#91ff6c26",selectionMatch:"#91ff6c26",gutterBackground:"#2a2734",gutterForeground:"#545167",lineHighlight:"#36334280"},vt=[{tag:[t.tags.comment,t.tags.bracket],color:"#6c6783"},{tag:[t.tags.atom,t.tags.number,t.tags.keyword,t.tags.link,t.tags.attributeName,t.tags.quote],color:"#ffcc99"},{tag:[t.tags.emphasis,t.tags.heading,t.tags.tagName,t.tags.propertyName,t.tags.className,t.tags.variableName],color:"#eeebff"},{tag:[t.tags.typeName,t.tags.url],color:"#7a63ee"},{tag:t.tags.operator,color:"#ffad5c"},{tag:t.tags.string,color:"#ffb870"},{tag:[t.tags.propertyName],color:"#9a86fd"},{tag:[t.tags.unit,t.tags.punctuation],color:"#e09142"}],Ct=a=>{var{theme:n="dark",settings:e={},styles:c=[]}={};return D({theme:n,settings:B({},yt,e),styles:[...vt,...c]})},xt=Ct();dt({light:{extension:bt},dark:{extension:xt},options:{settingsKey:"extension.markeditThemeDuoTone"}});
